<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Movie Player</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header class="topbar">
  <a href="index.html">⬅ Back</a>
  <h2 id="movieTitle">Loading...</h2>
</header>

<main class="player-page">

  <!-- VIDEO PLAYER -->
  <video id="videoPlayer" controls width="100%">
    <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
    Your browser does not support video.
  </video>

  <!-- ACTION BUTTONS -->
  <div class="movie-actions">
    <button id="watchBtn">▶ Watched</button>
    <button id="downloadBtn">⬇ Download</button>
  </div>

</main>

<script>
/***********************
  GET MOVIE ID
************************/
const params = new URLSearchParams(window.location.search);
const movieId = params.get("id");

/***********************
  MOVIE DATA (same ids)
************************/
const movies = [
  { id: "m1", title: "Avengers Endgame" },
  { id: "m2", title: "Inception" },
  { id: "m3", title: "Interstellar" },
  { id: "m4", title: "Joker" }
];

const movie = movies.find(m => m.id === movieId);
if (!movie) {
  alert("Movie not found");
  location.href = "index.html";
}

document.getElementById("movieTitle").innerText = movie.title;

/***********************
  CONTINUE WATCHING
************************/
const video = document.getElementById("videoPlayer");
const progressKey = "progress_" + movie.id;

video.currentTime = localStorage.getItem(progressKey) || 0;

video.addEventListener("timeupdate", () => {
  localStorage.setItem(progressKey, video.currentTime);
});

/***********************
  ANALYTICS
************************/
function trackClick(type) {
  let data = JSON.parse(localStorage.getItem("clickAnalytics")) || {};
  if (!data[movie.id]) {
    data[movie.id] = { title: movie.title, watch: 0, download: 0 };
  }
  data[movie.id][type]++;
  localStorage.setItem("clickAnalytics", JSON.stringify(data));
}

document.getElementById("watchBtn").onclick = () => {
  trackClick("watch");
  alert("Watch counted");
};

document.getElementById("downloadBtn").onclick = () => {
  trackClick("download");
  alert("Download counted");
};

/***********************
  RECENTLY VIEWED
************************/
let recent = JSON.parse(localStorage.getItem("recentMovies")) || [];
recent = recent.filter(m => m.id !== movie.id);
recent.unshift(movie);
recent = recent.slice(0, 6);
localStorage.setItem("recentMovies", JSON.stringify(recent));
</script>

</body>
</html>
